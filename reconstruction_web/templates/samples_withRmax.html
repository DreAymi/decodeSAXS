<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>decodeSAXS-samples</title>
    {% load staticfiles %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="{% static "./4/flatly/bootstrap.css" %}" media="screen">
    <link rel="stylesheet" href="{% static "./_assets/css/custom.min.css" %}">
    <link rel="stylesheet" href="{% static "./_vendor/bootstrap/dist/css/bootstrap-table.css" %}">
    <script src="{% static 'jsmol/JSmol.min.js' %}"></script>
    <script type="text/javascript">

      var Info = {
        width: 400,
        height: 400,
        debug: false,
        color: "white",
        addSelectionOptions: false,
        serverURL: "{% static 'js/jsmol/php/jsmol.php' %}",
        use: "HTML5",
        j2sPath: "{% static 'j2s' %}",
        disableInitialConsole: true
      };

      function jmolCheckbox(script1, script0,text,ischecked) {Jmol.jmolCheckbox(jmolApplet0,script1, script0, text, ischecked)}
      function jmolButton(script, text) {Jmol.jmolButton(jmolApplet0, script,text)}
      // function jmolScript(script) {Jmol.jmolScript(jmolApplet0, script)}
      function jmolHtml(s) { document.write(s) }
      function jmolBr() { jmolHtml("<br>") }
      function jmolMenu(a) {Jmol.jmolMenu(jmolApplet0, a)}

    </script>

  </head>
  <body>
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
      <div class="container">
        <a style="font-size: x-large" href="/index/" class="navbar-brand">decodeSAXS</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a style="font-size: large" class="nav-link" href="/index/">Home</a>
            </li>
            <li class="nav-item">
            <a style="font-size: large" class="nav-link" href="/submit/">Submit</a>
            </li>
            <li class="nav-item">
              <a style="font-size: large" class="nav-link" href="/check/">Check</a>
            </li>
            <li class="nav-item">
              <a style="font-size: large" class="nav-link" href="/history/">History</a>
            </li>
            <li class="nav-item">
                <div class="btn-group">
                    <button type="button" style="font-size: large;margin-top: 1px" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">Samples
                        <span class="caret"></span>
                    </button>
                    <ul width='10px' class="dropdown-menu" role="menu">
                        <li><a style="font-size: large;background-color: #476478" class="nav-link" href="/samples_withRmax/">withRmax</a></li>
                        <li><a style="font-size: large;background-color: #476478" class="nav-link" href="/samples_withoutRmax/">withoutRmax</a></li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
              <a style="font-size: large" class="nav-link" href="/tutorial/">Tutorial</a>
            </li>
            <li><a style="font-size: large" class="nav-link" href="https://github.com/DreAymi/SAXS_reconstruction"><i aria-hidden="true"></i> GitHub</a></li>
          </ul>
        </div>
      </div>
    </div>


    <div class="page-header">
        <table align="center" width="90%" border="1" cellspacing="0" cellpadding="0">
            <tr align="center">

            </tr>
            <tr align="center">
                <th width="30%">
                    <div align="center">
                        <script type="text/javascript">
                            jmolApplet0=Jmol.getApplet("jmolApplet0", Info);
                            /*
                            function loadjmol(sampleid){
                                var loadscript = 'load "../media/samples_withrmax/XXXX/XXXX_fit1_model1_za.pdb"; cartoon only; color yellowtint; isosurface cutoff 0.15 "../media/samples_withrmax/XXXX/out.ccp4";background white;color isosurface translucent; center $isosurface1;zoom 100; set spiny 10;set spinfps 15;spin off;';
                                loadscript=loadscript.replace(/XXXX/g, sampleid)
                                Jmol.script(jmolApplet0,loadscript);
                            }
                            loadjmol('SASDA25');
                            //var loadscript = 'load "../media/result/1556248482/out_za.pdb"; spacefill 1.5; color yellowtint; isosurface cutoff 0.15 "../media/result/1556248482/out1.ccp4";background white;color isosurface translucent; center $isosurface1;zoom 100; set spiny 10;set spinfps 15;spin off;';
                            //Jmol.script(jmolApplet0,loadscript);
                            */
                            jmolButton("cartoon only; color structure;", "cartoon");
                            jmolButton("spacefill 1.5; color yellowtint;", "spacefill");
                        </script>
                    </div>
                </th>
                <th width="60%">
                    <div align="center">
                        <div id="toolbar1">
                          <button style="margin-left: 10px" id="searchbutton" class="btn btn-primary">open search</button>
                        </div>
                        <table id="listSamples" data-toggle="table" data-toolbar="#toolbar1"></table>
                    </div>
                </th>
            </tr>

        </table>
    </div>

    <script src="{% static "./_vendor/jquery/dist/jquery.min.js" %}"></script>
    <script src="{% static "./_vendor/bootstrap/dist/js/bootstrap.min.js" %}"></script>
    <script src="{% static "./_vendor/bootstrap/dist/js/bootstrap-table.js" %}"></script>


    <script>
        function loadjmol(sampleid){
            var loadscript = 'load "../media/samples_withrmax/XXXX/XXXX_fit1_model1_za.pdb"; cartoon only; color yellowtint; isosurface cutoff 0.15 "../media/samples_withrmax/XXXX/out.ccp4";background white;color isosurface translucent; center $isosurface1;zoom 100; set spiny 10;set spinfps 15;spin off;';
            loadscript=loadscript.replace(/XXXX/g, sampleid)
            Jmol.script(jmolApplet0,loadscript);
        }
        function getsamples()

         {
            $('#listSamples').bootstrapTable('destroy');
            $('#listSamples').bootstrapTable({
            url: '/showsamples/?sampletype=withRmax',
            method: 'get',
            contentType:"application/x-www-form-urlencoded; charset=UTF-8", // 默认是：'application/json'， 不改的话，后台获取不到数据!

            cache: false,   //是否启用 数据缓存
            pagination: true,  //是都分页
            sidePageination: 'client',   //谁来分页，客户端：'client'，服务端：'server'
            pageNumber: 1,   //默认显示 首页
                pageSize: 10,     //每页需要显示的数据量
            pageList: [10, 25, 50],  //可供选择的，每页需要显示的数据量
            height: 630,       //表格高度
            uniqueId: 'samplename',
            silent: true,    // 刷新服务器数据
            showExport: true,
            exportDataType: 'all',

            columns: [{
                field: 'samplename',
                title: 'Sample Name',
                valign: 'middle',
                align: 'center',
                halign: 'center',
            }, {
                field: 'cc',
                title: 'CC',
                valign: 'middle',
                align: 'center',
                halign: 'center',
                sortable: true
            }, {
                field: 'samplename',
                title: 'Show Model',
                valign: 'middle',
                align: 'center',
                halign: 'center',
                formatter:function(value,row,index) {
                    if(index==0){
                        var loadscript = 'load "../media/samples_withrmax/XXXX/XXXX_fit1_model1_za.pdb"; cartoon only; color yellowtint; isosurface cutoff 0.15 "../media/samples_withrmax/XXXX/out.ccp4";background white;color isosurface translucent; center $isosurface1;zoom 100; set spiny 10;set spinfps 15;spin off;';
                        loadscript=loadscript.replace(/XXXX/g, value)
                        Jmol.script(jmolApplet0,loadscript);
                    }

                    return [
                    "<button onclick=loadjmol(\""+value+"\")>show</button>"
                    ].join("");

                }
            }],
            responseHandler: function(res) {   //处理 从后端 返回的数据
                console.log(res);
                if (res == 0) {
                    alert('查询出问题！');
                } else {
                    var orderListData = res['rows'];
                    return orderListData;
                }
            },
            onLoadError: function (status) {
                console.log(status);
                $('#order_list').bootstrapTable('removeAll');
            }
            })
        }
        getsamples();
        $(function() {
            $("#searchbutton").click(function () {
              $("#listSamples").bootstrapTable('refreshOptions', {
                //showColumns: true,
                search: true,
                //showRefresh: true,
              });
              //var search="input search condition";
              //$("#listSamples").bootstrapTable('resetSearch', search);
            })
          })

    </script>

    <div class="text" style=" text-align:center;margin-top: 120px">Building 9, East Zone, ZPark II, No.10 East Xibeiwang Road, Haidian District, Beijing 100193, China</div>
    <div class="text" style=" text-align:center;">Department of Complex System</div>

</body>

</html>

